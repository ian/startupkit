---
title: Authentication
description: Set up authentication flows with Better Auth
---

# Authentication

StartupKit uses [Better Auth](https://better-auth.com) for authentication. The `@repo/auth` package provides React hooks and context for easy integration.

## Overview

The authentication system supports:

- **Email OTP** - One-time password via email
- **Google OAuth** - Sign in with Google
- **Session Management** - 7-day sessions with auto-refresh

## Setting Up Authentication

### 1. Configure Better Auth

Create your auth configuration in `lib/auth.ts`:

```typescript title="apps/web/src/lib/auth.ts"
import { betterAuth } from "better-auth"
import { drizzleAdapter } from "better-auth/adapters/drizzle"
import { nextCookies } from "better-auth/next-js"
import { emailOTP } from "better-auth/plugins"
import { db } from "@repo/db"

export const auth = betterAuth({
  basePath: "/auth",
  database: drizzleAdapter(db, {
    provider: "pg"
  }),
  session: {
    expiresIn: 60 * 60 * 24 * 7, // 7 days
    updateAge: 60 * 60 * 24     // Refresh daily
  },
  plugins: [
    emailOTP({
      sendVerificationOTP: async ({ email, otp }) => {
        // Send OTP via your email provider
        await sendEmail({
          to: email,
          subject: "Your verification code",
          template: "otp",
          data: { code: otp }
        })
      }
    }),
    nextCookies()
  ],
  socialProviders: {
    google: {
      clientId: process.env.GOOGLE_CLIENT_ID!,
      clientSecret: process.env.GOOGLE_CLIENT_SECRET!
    }
  }
})
```

### 2. Create API Route

Create the auth API route:

```typescript title="apps/web/src/app/auth/[...all]/route.ts"
import { auth } from "@/lib/auth"
import { toNextJsHandler } from "better-auth/next-js"

export const { GET, POST } = toNextJsHandler(auth.handler)
```

### 3. Create Auth Client

Create the client-side auth client:

```typescript title="apps/web/src/lib/auth-client.ts"
import { createAuthClient } from "better-auth/react"
import { emailOTPClient } from "better-auth/client/plugins"

export const authClient = createAuthClient({
  basePath: "/auth",
  plugins: [emailOTPClient()]
})
```

### 4. Set Up Providers

Wrap your app with `AuthProvider`:

```tsx title="apps/web/src/app/providers.tsx"
"use client"

import { AuthProvider } from "@repo/auth"
import { authClient } from "@/lib/auth-client"

interface ProvidersProps {
  children: React.ReactNode
  user?: User
}

export function Providers({ children, user }: ProvidersProps) {
  return (
    <AuthProvider authClient={authClient} user={user}>
      {children}
    </AuthProvider>
  )
}
```

Pass the user from your root layout:

```tsx title="apps/web/src/app/layout.tsx"
import { auth } from "@/lib/auth"
import { headers } from "next/headers"
import { Providers } from "./providers"

export default async function RootLayout({ children }) {
  const session = await auth.api.getSession({
    headers: await headers()
  })

  return (
    <html>
      <body>
        <Providers user={session?.user}>
          {children}
        </Providers>
      </body>
    </html>
  )
}
```

## Using Authentication

### Check Auth State

```tsx
"use client"

import { useAuth } from "@repo/auth"

export function UserProfile() {
  const { isAuthenticated, isLoading, user, logout } = useAuth()

  if (isLoading) return <div>Loading...</div>
  
  if (!isAuthenticated) return <a href="/sign-in">Sign In</a>

  return (
    <div>
      <p>Welcome, {user.name}</p>
      <button onClick={logout}>Sign Out</button>
    </div>
  )
}
```

### Email OTP Sign In

```tsx
"use client"

import { useAuth } from "@repo/auth"
import { useState } from "react"

export function EmailSignIn() {
  const { sendAuthCode, verifyAuthCode } = useAuth()
  const [email, setEmail] = useState("")
  const [code, setCode] = useState("")
  const [step, setStep] = useState<"email" | "code">("email")

  const handleSendCode = async (e: React.FormEvent) => {
    e.preventDefault()
    await sendAuthCode(email)
    setStep("code")
  }

  const handleVerifyCode = async (e: React.FormEvent) => {
    e.preventDefault()
    await verifyAuthCode(email, code)
  }

  if (step === "email") {
    return (
      <form onSubmit={handleSendCode}>
        <input
          type="email"
          value={email}
          onChange={(e) => setEmail(e.target.value)}
          placeholder="Enter your email"
        />
        <button type="submit">Send Code</button>
      </form>
    )
  }

  return (
    <form onSubmit={handleVerifyCode}>
      <input
        type="text"
        value={code}
        onChange={(e) => setCode(e.target.value)}
        placeholder="Enter verification code"
      />
      <button type="submit">Verify</button>
    </form>
  )
}
```

### Google Sign In

```tsx
"use client"

import { useAuth } from "@repo/auth"

export function GoogleSignIn() {
  const { googleAuth } = useAuth()

  return (
    <button onClick={googleAuth}>
      Sign in with Google
    </button>
  )
}
```

## Protecting Routes

### Server Components

```tsx
import { auth } from "@/lib/auth"
import { headers } from "next/headers"
import { redirect } from "next/navigation"

export default async function ProtectedPage() {
  const session = await auth.api.getSession({
    headers: await headers()
  })

  if (!session) redirect("/sign-in")

  return <div>Protected content for {session.user.name}</div>
}
```

### API Routes

```tsx
import { auth } from "@/lib/auth"
import { headers } from "next/headers"
import { NextResponse } from "next/server"

export async function GET() {
  const session = await auth.api.getSession({
    headers: await headers()
  })

  if (!session) {
    return NextResponse.json({ error: "Unauthorized" }, { status: 401 })
  }

  return NextResponse.json({ user: session.user })
}
```

## Environment Variables

```bash
# Required for Google OAuth
GOOGLE_CLIENT_ID=your_google_client_id
GOOGLE_CLIENT_SECRET=your_google_client_secret

# Required for Better Auth
BETTER_AUTH_SECRET=your_secret_key
```

## Next Steps

- [Analytics Setup](/docs/guides/analytics-setup) - Track user events
- [Better Auth Docs](https://better-auth.com/docs) - Full configuration options
