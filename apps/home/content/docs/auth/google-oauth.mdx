---
title: Google OAuth Setup
description: How to configure Google sign-in for your application
---

Let users sign in with their Google account. Fast, secure, and familiar.

## Prerequisites

- Google Cloud Console account
- Domain for OAuth redirect (localhost works for development)

## Configuration

### 1. Create Google OAuth Credentials

1. Go to [Google Cloud Console](https://console.cloud.google.com)
2. Create a new project (or select existing)
3. Navigate to **APIs & Services → Credentials**
4. Click **Create Credentials → OAuth client ID**
5. Select **Web application**
6. Add authorized redirect URIs:
   - Development: `http://localhost:3000/auth/callback/google`
   - Production: `https://yourdomain.com/auth/callback/google`
7. Copy the **Client ID** and **Client Secret**

### 2. Set Environment Variables

```bash title=".env.local"
GOOGLE_CLIENT_ID=your_client_id.apps.googleusercontent.com
GOOGLE_CLIENT_SECRET=your_client_secret
```

### 3. Configure Better Auth

```tsx title="lib/auth.ts"
import { betterAuth } from "better-auth"
import { drizzleAdapter } from "better-auth/adapters/drizzle"
import { nextCookies } from "better-auth/next-js"
import { db } from "@repo/db"

export const auth = betterAuth({
  basePath: "/auth",
  database: drizzleAdapter(db, { provider: "pg" }),
  plugins: [nextCookies()],
  socialProviders: {
    google: {
      clientId: process.env.GOOGLE_CLIENT_ID!,
      clientSecret: process.env.GOOGLE_CLIENT_SECRET!,
      // Optional: Map profile data to user fields
      mapProfileToUser: async (profile) => ({
        name: `${profile.given_name} ${profile.family_name}`,
        firstName: profile.given_name,
        lastName: profile.family_name,
        image: profile.picture
      })
    }
  }
})
```

## Building the Sign-In Button

### Basic Button

```tsx title="components/google-sign-in.tsx"
"use client"

import { useAuth } from "@startupkit/auth"

export function GoogleSignIn() {
  const { googleAuth } = useAuth()

  return (
    <button onClick={googleAuth}>
      Sign in with Google
    </button>
  )
}
```

### With Shadcn UI

```tsx title="components/google-sign-in.tsx"
"use client"

import { useAuth } from "@startupkit/auth"
import { Button } from "@repo/ui/button"

export function GoogleSignIn() {
  const { googleAuth } = useAuth()

  return (
    <Button onClick={googleAuth} variant="outline" className="w-full">
      <GoogleIcon className="mr-2 h-4 w-4" />
      Continue with Google
    </Button>
  )
}

function GoogleIcon({ className }: { className?: string }) {
  return (
    <svg className={className} viewBox="0 0 24 24">
      <path
        fill="currentColor"
        d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"
      />
      <path
        fill="currentColor"
        d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"
      />
      <path
        fill="currentColor"
        d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"
      />
      <path
        fill="currentColor"
        d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"
      />
    </svg>
  )
}
```

### Combined Sign-In Page

```tsx title="app/sign-in/page.tsx"
"use client"

import { GoogleSignIn } from "@/components/google-sign-in"
import { EmailSignIn } from "@/components/email-sign-in"

export default function SignInPage() {
  return (
    <div className="max-w-sm mx-auto p-6">
      <h1 className="text-2xl font-bold mb-6">Sign In</h1>
      
      <GoogleSignIn />
      
      <div className="relative my-6">
        <div className="absolute inset-0 flex items-center">
          <div className="w-full border-t" />
        </div>
        <div className="relative flex justify-center text-sm">
          <span className="bg-background px-2 text-muted-foreground">
            Or continue with
          </span>
        </div>
      </div>
      
      <EmailSignIn />
    </div>
  )
}
```

## Profile Data Mapping

Customize what user data is stored from Google profiles:

```tsx
socialProviders: {
  google: {
    clientId: process.env.GOOGLE_CLIENT_ID!,
    clientSecret: process.env.GOOGLE_CLIENT_SECRET!,
    mapProfileToUser: async (profile) => {
      // profile contains Google's user data:
      // - sub (Google user ID)
      // - email
      // - email_verified
      // - name
      // - given_name
      // - family_name
      // - picture
      // - locale

      return {
        name: profile.name,
        firstName: profile.given_name,
        lastName: profile.family_name,
        image: profile.picture
        // Add custom fields as needed
      }
    }
  }
}
```

## Account Linking

When a user signs in with Google after using email OTP (or vice versa), Better Auth can link the accounts:

```tsx
export const auth = betterAuth({
  // ...
  account: {
    accountLinking: {
      enabled: true  // Allow linking accounts with same email
    }
  }
})
```

## Conditional Rendering

Check which auth method was used:

```tsx
"use client"

import { useAuth } from "@startupkit/auth"

export function AccountSettings() {
  const { user } = useAuth()

  // Check if user signed in with Google
  const hasGoogleAccount = user?.accounts?.some(
    a => a.providerId === "google"
  )

  return (
    <div>
      {hasGoogleAccount ? (
        <p>Connected with Google</p>
      ) : (
        <GoogleSignIn />
      )}
    </div>
  )
}
```

## Environment Variables

| Variable | Description |
|----------|-------------|
| `GOOGLE_CLIENT_ID` | OAuth client ID from Google Cloud Console |
| `GOOGLE_CLIENT_SECRET` | OAuth client secret |

## Troubleshooting

### "redirect_uri_mismatch" Error

The redirect URI in your Google Cloud Console doesn't match your app:

1. Go to Google Cloud Console → Credentials
2. Edit your OAuth client
3. Add the exact redirect URI: `http://localhost:3000/auth/callback/google`
4. For production, add: `https://yourdomain.com/auth/callback/google`

### "Access Blocked" Error

Your app may need to be verified by Google:

1. For testing, add your email to test users in OAuth consent screen
2. For production, submit for Google verification

### Profile Picture Not Showing

Ensure you're mapping the profile correctly:

```tsx
mapProfileToUser: async (profile) => ({
  image: profile.picture  // Must be named 'image' for Better Auth
})
```

## Security Considerations

1. **Never expose client secret** - Keep it in environment variables only
2. **Use HTTPS in production** - Required for OAuth
3. **Validate email domain** - Optionally restrict to certain domains:

```tsx
socialProviders: {
  google: {
    clientId: process.env.GOOGLE_CLIENT_ID!,
    clientSecret: process.env.GOOGLE_CLIENT_SECRET!,
    mapProfileToUser: async (profile) => {
      // Restrict to company domain
      if (!profile.email?.endsWith("@yourcompany.com")) {
        throw new Error("Only company emails allowed")
      }
      return { name: profile.name }
    }
  }
}
```

## Next Steps

- [Email OTP](/docs/auth/email-otp) - Add email authentication
- [Protecting routes](/docs/auth/protecting-routes) - Secure your pages
