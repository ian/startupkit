---
title: Email OTP Setup
description: How to configure email one-time password authentication
---

Email OTP (One-Time Password) lets users sign in by entering a code sent to their email. No passwords to remember.

## How It Works

1. User enters their email
2. Server sends a 6-digit code
3. User enters the code
4. Session is created

## Configuration

### 1. Configure Better Auth

```tsx title="lib/auth.ts"
import { betterAuth } from "better-auth"
import { emailOTP } from "better-auth/plugins"
import { drizzleAdapter } from "better-auth/adapters/drizzle"
import { nextCookies } from "better-auth/next-js"
import { db } from "@repo/db"
import { sendEmail } from "@repo/emails"

export const auth = betterAuth({
  basePath: "/auth",
  database: drizzleAdapter(db, { provider: "pg" }),
  plugins: [
    emailOTP({
      sendVerificationOTP: async ({ email, otp }) => {
        await sendEmail({
          template: "VerifyCode",
          to: email,
          subject: "Your verification code",
          props: {
            email,
            otpCode: otp,
            expiryTime: "10 minutes"
          }
        })
      },
      otpLength: 6,           // Code length (default: 6)
      expiresIn: 600          // Seconds until expiry (default: 600 = 10 min)
    }),
    nextCookies()
  ]
})
```

### 2. Create Auth Client

```tsx title="lib/auth-client.ts"
import { createAuthClient } from "better-auth/react"
import { emailOTPClient } from "better-auth/client/plugins"

export const authClient = createAuthClient({
  basePath: "/auth",
  plugins: [emailOTPClient()]
})
```

### 3. Set Up Email Template

Create an email template for the OTP:

```tsx title="packages/emails/src/templates/verify-code.tsx"
import { Html, Text, Container } from "@react-email/components"

interface VerifyCodeProps {
  email: string
  otpCode: string
  expiryTime: string
}

export function VerifyCode({ email, otpCode, expiryTime }: VerifyCodeProps) {
  return (
    <Html>
      <Container>
        <Text>Your verification code is:</Text>
        <Text style={{ fontSize: "32px", fontWeight: "bold" }}>
          {otpCode}
        </Text>
        <Text>
          This code expires in {expiryTime}.
        </Text>
        <Text>
          If you didn't request this code, you can ignore this email.
        </Text>
      </Container>
    </Html>
  )
}
```

## Building the Sign-In UI

### Two-Step Form

```tsx title="app/sign-in/page.tsx"
"use client"

import { useAuth } from "@startupkit/auth"
import { useState } from "react"

export default function SignInPage() {
  const { sendAuthCode, verifyAuthCode } = useAuth()
  const [email, setEmail] = useState("")
  const [code, setCode] = useState("")
  const [step, setStep] = useState<"email" | "code">("email")
  const [isLoading, setIsLoading] = useState(false)
  const [error, setError] = useState("")

  const handleSendCode = async (e: React.FormEvent) => {
    e.preventDefault()
    setIsLoading(true)
    setError("")

    try {
      await sendAuthCode(email)
      setStep("code")
    } catch (err) {
      setError("Failed to send code. Please try again.")
    } finally {
      setIsLoading(false)
    }
  }

  const handleVerifyCode = async (e: React.FormEvent) => {
    e.preventDefault()
    setIsLoading(true)
    setError("")

    try {
      await verifyAuthCode(email, code)
      // Redirect happens automatically
    } catch (err) {
      setError("Invalid code. Please try again.")
    } finally {
      setIsLoading(false)
    }
  }

  if (step === "email") {
    return (
      <form onSubmit={handleSendCode}>
        <h1>Sign In</h1>
        <input
          type="email"
          value={email}
          onChange={(e) => setEmail(e.target.value)}
          placeholder="Enter your email"
          required
        />
        {error && <p className="text-red-500">{error}</p>}
        <button type="submit" disabled={isLoading}>
          {isLoading ? "Sending..." : "Send Code"}
        </button>
      </form>
    )
  }

  return (
    <form onSubmit={handleVerifyCode}>
      <h1>Enter Code</h1>
      <p>We sent a code to {email}</p>
      <input
        type="text"
        value={code}
        onChange={(e) => setCode(e.target.value)}
        placeholder="Enter 6-digit code"
        maxLength={6}
        required
      />
      {error && <p className="text-red-500">{error}</p>}
      <button type="submit" disabled={isLoading}>
        {isLoading ? "Verifying..." : "Verify"}
      </button>
      <button type="button" onClick={() => setStep("email")}>
        Use different email
      </button>
    </form>
  )
}
```

### With Shadcn UI

```tsx title="app/sign-in/page.tsx"
"use client"

import { useAuth } from "@startupkit/auth"
import { Button } from "@repo/ui/button"
import { Input } from "@repo/ui/input"
import { Card, CardContent, CardHeader, CardTitle } from "@repo/ui/card"
import { useState } from "react"

export default function SignInPage() {
  const { sendAuthCode, verifyAuthCode } = useAuth()
  const [email, setEmail] = useState("")
  const [code, setCode] = useState("")
  const [step, setStep] = useState<"email" | "code">("email")

  // ... rest of implementation
}
```

## API Reference

### sendAuthCode(email)

Sends a one-time code to the specified email.

```tsx
const { sendAuthCode } = useAuth()

await sendAuthCode("user@example.com")
```

- Throws if email is invalid or rate limited
- Code expires after 10 minutes by default

### verifyAuthCode(email, code)

Verifies the code and creates a session.

```tsx
const { verifyAuthCode } = useAuth()

await verifyAuthCode("user@example.com", "123456")
```

- Throws if code is invalid or expired
- Creates session and redirects on success

## Customization

### Code Length

```tsx
emailOTP({
  otpLength: 8  // Use 8-digit codes
})
```

### Expiry Time

```tsx
emailOTP({
  expiresIn: 300  // 5 minutes
})
```

### Rate Limiting

Better Auth includes built-in rate limiting. Configure in the main auth config:

```tsx
export const auth = betterAuth({
  rateLimit: {
    window: 60,      // 60 seconds
    max: 5           // 5 requests per window
  }
})
```

## Troubleshooting

### Codes Not Sending

1. Check your email provider configuration
2. Verify environment variables are set
3. Check server logs for errors

### Invalid Code Errors

1. Ensure user enters code within expiry time
2. Check for copy/paste issues (spaces, etc.)
3. Verify code length matches configuration

### Rate Limiting

If users hit rate limits:
1. Show clear error messages
2. Implement countdown timer
3. Consider adjusting rate limit settings

## Next Steps

- [Google OAuth](/docs/auth/google-oauth) - Add social sign-in
- [Protecting routes](/docs/auth/protecting-routes) - Secure your pages
